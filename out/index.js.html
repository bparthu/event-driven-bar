<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const faker = require('faker')
const logUpdate = require('log-update')
const uuid = require('uuid').v4
const BarManager = require('./model/BarManager')
const Customer = require('./model/Customer')
const CONSTANTS = require('./constants')
const util = require('./util')
const template = require('./template')
const ConsoleObserver = require('./Observer/ConsoleObserver')

// instantiate Console Observer
const consoleObserver = new ConsoleObserver(uuid())
// start listeners
consoleObserver.startListeners()


const Patron = {
/**
 * while bar is still open, a new customer visits the bar after the random delay (delay can be configured).
 *
 * @generator
 * @function generator
 * @yields {Customer} the instance of Customer
 */
  generator: async function*(bar) {
    while(bar.isOpen()) {
      await util.takeTime(util.getRandomInt(CONSTANTS.CUSTOMER_ARRIVAL_TIME_MIN, CONSTANTS.CUSTOMER_ARRIVAL_TIME_MAX))
      yield new Customer(`${faker.name.firstName()} ${faker.name.lastName()}`, bar) 
    }
  }
}

/*
  1. create a named bar with configured seating capacity and waiting capacity
  2. add external observers
  3. bar should be closed after being open for configured time limit
  4. customers can visit the bar once the bar is opened
*/
BarManager
  .createBar(`${faker.name.firstName()}'s beer bar`, {
    seatingCapacity: CONSTANTS.SEATING_CAPACITY,
    waitingCapacity: CONSTANTS.WAITING_CAPACITY
  })
  .setObservers([consoleObserver])
  .closeAfter(CONSTANTS.BAR_TIME, CONSTANTS.PER_HOUR_IN_MS)
  .openBar(async (bar) => {
    for await(const customer of Patron.generator(bar)) {
      await customer.registerEvents()
      customer.setObservers([consoleObserver])
      bar.emit('new-customer', customer)
    }
  })

  // notification event is triggered when the state of bar changes
  consoleObserver.on('notification', (observer, ctx) => {
    logUpdate(template(observer.getId(), ctx, CONSTANTS.WAITING_CAPACITY, CONSTANTS.SEATING_CAPACITY, CONSTANTS.BAR_TIME))
  })</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#generator">generator</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Tue Apr 07 2020 21:10:33 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
